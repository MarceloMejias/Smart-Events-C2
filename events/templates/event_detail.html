{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ evento.nombre }} - Smart Events</title>
    
    <!-- Bootswatch Quartz Theme -->
    <link rel="stylesheet" href="{% static 'css/bootstrap-quartz.css' %}">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-dark">
    <!-- Incluir la navbar -->
    {% include 'sidebar.html' %}

    <!-- Hero con imagen de fondo -->
    <div class="position-relative" style="min-height: 100vh;">
        <!-- Imagen de fondo con blur -->
        <div class="position-absolute top-0 start-0 w-100 h-100" style="z-index: 0;">
            {% if evento.imagen %}
            <img src="{{ evento.imagen.url }}" class="w-100 h-100" style="object-fit: cover; filter: blur(20px) brightness(0.3);" alt="{{ evento.nombre }}">
            {% else %}
            <div class="w-100 h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); filter: blur(20px) brightness(0.3);"></div>
            {% endif %}
        </div>

    <!-- Contenido principal -->
    <div class="container-fluid position-relative px-4 px-md-5" style="z-index: 1; padding-top: 3rem; padding-bottom: 3rem;">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <!-- Tarjeta de detalle del evento -->
                    <div class="card border-0 shadow-lg">
                        <!-- Imagen del evento -->
                        {% if evento.imagen %}
                        <div class="ratio-16-10">
                            <img src="{{ evento.imagen.url }}" class="card-img-top" alt="{{ evento.nombre }}">
                        </div>
                        {% else %}
                        <div class="ratio-16-10 bg-gradient d-flex align-items-center justify-content-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-calendar-alt fa-5x text-white opacity-50"></i>
                        </div>
                        {% endif %}

                        <div class="card-body p-4 p-md-5">
                            <!-- Badge de tipo -->
                            <div class="mb-3">
                                <span class="badge 
                                    {% if evento.tipo == 'CHARLA' %}bg-primary
                                    {% elif evento.tipo == 'TALLER' %}bg-success
                                    {% elif evento.tipo == 'FERIA' %}bg-warning text-dark
                                    {% elif evento.tipo == 'CONCIERTO' %}bg-danger
                                    {% endif %} fs-6 px-3 py-2">
                                    {% if evento.tipo == 'CHARLA' %}
                                        <i class="fas fa-microphone me-2"></i>
                                    {% elif evento.tipo == 'TALLER' %}
                                        <i class="fas fa-tools me-2"></i>
                                    {% elif evento.tipo == 'FERIA' %}
                                        <i class="fas fa-store me-2"></i>
                                    {% elif evento.tipo == 'CONCIERTO' %}
                                        <i class="fas fa-music me-2"></i>
                                    {% endif %}
                                    {{ evento.get_tipo_display }}
                                </span>
                                {% if evento.destacado %}
                                <span class="badge bg-warning text-dark fs-6 px-3 py-2">
                                    <i class="fas fa-star me-2"></i>
                                    Destacado
                                </span>
                                {% endif %}
                            </div>

                            <!-- Título -->
                            <h1 class="display-5 fw-bold text-white mb-4">{{ evento.nombre }}</h1>

                            <!-- Información clave -->
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center text-white-50">
                                        <i class="fas fa-calendar fa-lg text-primary me-3"></i>
                                        <div>
                                            <small class="d-block text-muted">Fecha de inicio</small>
                                            <strong class="text-white">{{ evento.fecha_inicio|date:"d M Y, H:i" }}</strong>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center text-white-50">
                                        <i class="fas fa-calendar-check fa-lg text-primary me-3"></i>
                                        <div>
                                            <small class="d-block text-muted">Fecha de fin</small>
                                            <strong class="text-white">{{ evento.fecha_fin|date:"d M Y, H:i" }}</strong>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center text-white-50">
                                        <i class="fas fa-map-marker-alt fa-lg text-primary me-3"></i>
                                        <div>
                                            <small class="d-block text-muted">Ubicación</small>
                                            <strong class="text-white">{{ evento.lugar }}</strong>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center text-white-50">
                                        <i class="fas fa-users fa-lg text-primary me-3"></i>
                                        <div>
                                            <small class="d-block text-muted">Capacidad</small>
                                            {% if evento.capacidad %}
                                            <strong class="text-white">{{ evento.total_registrados }}/{{ evento.capacidad }} personas</strong>
                                            {% else %}
                                            <strong class="text-white">Ilimitada</strong>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% if evento.precio %}
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center text-white-50">
                                        <i class="fas fa-ticket fa-lg text-success me-3"></i>
                                        <div>
                                            <small class="d-block text-muted">Precio</small>
                                            <strong class="text-success fs-4">${{ evento.precio }}</strong>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center text-white-50">
                                        <i class="fas fa-gift fa-lg text-success me-3"></i>
                                        <div>
                                            <small class="d-block text-muted">Precio</small>
                                            <strong class="text-success fs-4">Gratis</strong>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <hr class="border-secondary opacity-25 my-4">

                            <!-- Descripción -->
                            <div class="mb-4">
                                <h4 class="text-white mb-3">
                                    <i class="fas fa-info-circle text-primary me-2"></i>
                                    Descripción
                                </h4>
                                <p class="text-white-50 fs-5 lh-base">{{ evento.descripcion }}</p>
                            </div>

                            <hr class="border-secondary opacity-25 my-4">

                            <!-- Botones de acción -->
                            <div class="d-flex gap-3 flex-wrap">
                                {% if user.is_authenticated %}
                                    {% if ya_registrado %}
                                        <button class="btn btn-success btn-lg px-5 flex-grow-1" disabled>
                                            <i class="fas fa-check-circle me-2"></i>
                                            Ya estás registrado
                                        </button>
                                        <form method="post" action="{% url 'event_register' evento.id %}" class="flex-grow-1">
                                            {% csrf_token %}
                                            <input type="hidden" name="cancel" value="1">
                                            <button type="submit" class="btn btn-outline-danger btn-lg px-5 w-100" onclick="return confirm('¿Estás seguro de cancelar tu registro?')">
                                                <i class="fas fa-times me-2"></i>
                                                Cancelar Registro
                                            </button>
                                        </form>
                                    {% elif evento.puede_registrarse %}
                                        <form method="post" action="{% url 'event_register' evento.id %}" class="flex-grow-1">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-primary btn-lg px-5 w-100">
                                                <i class="fas fa-user-plus me-2"></i>
                                                Registrarse en el Evento
                                            </button>
                                        </form>
                                    {% else %}
                                        <button class="btn btn-secondary btn-lg px-5 flex-grow-1" disabled>
                                            <i class="fas fa-times me-2"></i>
                                            Evento Lleno o Finalizado
                                        </button>
                                    {% endif %}
                                {% else %}
                                    <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary btn-lg px-5 flex-grow-1">
                                        <i class="fas fa-sign-in-alt me-2"></i>
                                        Inicia Sesión para Registrarte
                                    </a>
                                {% endif %}
                                <a href="{% url 'events' %}" class="btn btn-outline-light btn-lg px-4">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Volver
                                </a>
                            </div>

                            <!-- Mensajes -->
                            {% if messages %}
                            <div class="mt-4">
                                {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} border-start border-4 border-{{ message.tags }} d-flex align-items-center" role="alert">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <div>{{ message }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Información adicional -->
                    <div class="row g-4 mt-4">
                        <div class="col-md-6">
                            <div class="card border-0 shadow">
                                <div class="card-body p-4">
                                    <h5 class="text-white mb-3">
                                        <i class="fas fa-chart-line text-primary me-2"></i>
                                        Estadísticas
                                    </h5>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-muted">Personas registradas</span>
                                        <strong class="text-white">{{ evento.total_registrados }}</strong>
                                    </div>
                                    {% if evento.capacidad %}
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: {{ evento.porcentaje_ocupacion }}%"></div>
                                    </div>
                                    <small class="text-muted">{{ evento.porcentaje_ocupacion }}% de capacidad</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow">
                                <div class="card-body p-4">
                                    <h5 class="text-white mb-3">
                                        <i class="fas fa-clock text-primary me-2"></i>
                                        Duración
                                    </h5>
                                    <p class="text-white-50 mb-0">
                                        <i class="fas fa-hourglass-half me-2"></i>
                                        Desde el {{ evento.fecha_inicio|date:"d/m/Y H:i" }}<br>
                                        hasta el {{ evento.fecha_fin|date:"d/m/Y H:i" }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Incluir el footer -->
    {% include 'footer.html' %}

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- No custom .glass-card styles: using native Bootstrap classes only -->
    <style>
        .ratio-16-10 {
            width: 100%;
            aspect-ratio: 16 / 10;
            overflow: hidden;
            display: block;
        }

        .ratio-16-10 > img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
    </style>
</body>
</html>
